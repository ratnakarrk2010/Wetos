@model WetosMVCMainApp.Models.MessageModel
@System.Web.Optimization.Styles.Render("~/Content/Select2")
@System.Web.Optimization.Scripts.Render("~/bundles/Select2")
@System.Web.Optimization.Scripts.Render("~/bundles/CKEditor")
<link href="@Url.Content("~/Content/select2.min.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/select2.full.min.js")" type="text/javascript"></script>
<script src="~/Scripts/bootstrap.min.js"></script>
<style>
    .form .form-actions {
        background-color: #ffffff;
        border-top: 0px solid #e5e5e5;
    }

    .select2-container--default .select2-selection--single {
        border-radius: 5px !important;
    }

    .input_mar {
        margin-top: 2%;
    }

    @@media screen and (min-width: 320px) and (max-width: 767px) {
        .m_btn_bule {
            height: 35px !important;
            margin-top: 0% !important;
        }

        .input_mar {
            margin-top: 0%;
        }

        .m_div_padding {
            padding-right: 0px;
            padding-left: 0px !important;
            margin-top: -12%;
        }

        .m_mess_div {
            margin-top: 0%;
        }
    }

    @@media screen and (min-width: 768px) and (max-width: 1023px) {
        .input_mar {
            margin-top: 0%;
        }

        .form .form-actions.fluid {
            padding: 0px 00px 10px 0px;
        }
    }
</style>

<div id="div_readmore">
</div>
<div class="portlet box purple ">
    <div class="portlet-title">
        <div class="caption">
            <i class="fa fa-gift"></i>New Message
        </div>
    </div>
    <div class="portlet-body form">
        @using (Html.BeginForm())
        {
            @*<form class="form-horizontal" role="form" method="post" action="@Url.Content("~/Home/SendMessage")">*@
            @Html.HiddenFor(model => model.FromEmpId)
            <div class="form-body">
                <div class="form-group">
                    <label class="col-md-2 control-label">
                    </label>
                    <div id="alert">
                    </div>
                </div>
                <div class="form-group ">
                    <label class="col-md-3 control-label">
                        To<span id="ToBlnk">*</span>
                    </label>
                    <div class="col-md-9">
                        @Html.DropDownListFor(a => a.ToEmpTypeId, (IEnumerable<SelectListItem>)ViewBag.MessageSendToList, "Select", new { @class = "form-control select2", id = "ToEmpTypeId", @name = "ToEmpTypeId" })
                        <div id="ToEmpTypeIdmsg" style="color:red"></div>
                    </div>

                </div>

                <div class=" form-group" id="IndividualEmployees" style="display: none">
                    <label class="col-md-3 control-label">
                        Select Emp.
                    </label>
                    <div class="col-md-9">
                        @Html.DropDownListFor(a => a.ToEmpId, (IEnumerable<SelectListItem>)ViewBag.EmployeeList, "Select", new { @class = "form-control select2", id = "ToEmpId", @name = "ToEmpId" })
                        <div id="ToEmpIdmsg" style="color:red"></div>
                    </div>

                </div>

                <div class="form-group">
                    <label class="col-md-3 control-label">
                        Subject<span id="SubjectBlnk">*</span>
                    </label>
                    <div class="col-md-9">
                        @Html.DropDownListFor(a => a.MessageSubject, (IEnumerable<SelectListItem>)ViewBag.MessageSubjectList, "Select", new { @class = "form-control select2 input_mar", id = "MessageSubject", @name = "MessageSubject" })
                        @*  @Html.TextBoxFor(a => a.MessageSubject, new { @placeholder = "Message Subject", @name = "MessageSubject", @class = "form-control input-sm" })*@
                        @*<input class="form-control input-sm" placeholder="Message Subject" type="text" id="txtmsgsubject"
                            name="txtmsgsubject" />*@

                        <input class="form-control input-sm" style="display: none" placeholder="Please enter message subject here"
                               type="text" id="MessageSubjectText" name="MessageSubjectText" />
                        <div id="idMessageSubject" style="color: red"></div>
                    </div>

                </div>
                @*  <div class="form-group">
                        <label class="col-md-2 control-label">
                            Type :</label>
                        <div class="col-md-9">
                            @Html.DropDownList("msgType", null, "--Select--", new { @class = "form-control input-sm" })
                        </div>
                    </div>*@
                <div class="form-group m_mess_div">
                    <label class="col-md-3 control-label">
                        Message<span id="MessageBlnk">*</span>
                    </label>
                    <div class="col-md-9">
                        @Html.TextAreaFor(a => a.MessageContent, 10, 80, new { @placeholder = "Message Content", @name = "MessageContent", @class = "form-control input-sm input_mar" })
                        @*<textarea class="form-control" name="editor1" id="txtmsgcontent" rows="10" cols="80">*@
                        @*<textarea class="form-control" rows="5" style="resize: none" id="txtmsgcontent" name="txtmsgcontent"></textarea>*@
                        <div id="idMessageContent" style="color:red"></div>
                    </div>

                </div>

                <div class="form-actions fluid">

                    <div class="col-md-offset-3 col-md-9 m_div_padding">
                        <br />
                        <button type="button" id="BtnSubmit" class="btn btn-md green">

                            Send Message
                        </button>
                        @*ADDED CODE BY SHRADDHA ON 23 JAN 2017 FOR SENDING EMAIL START*@
                        @*<input type="button" value="Send Email " class="btn btn-md red" id="SendEmail" onclick="Valid(event)" />*@
                        <input type="button" value="Send Email " class="btn btn-md red" id="SendEmail" />
                        @* <a href="@Url.Action("emailpage","WetosEmail")" class="btn blue" id="btnback">emailpage</a>*@
                        @*ADDED CODE BY SHRADDHA ON 23 JAN 2017 FOR SENDING EMAIL END*@@*           <a  class="btn default" onclick="@Url.Content("~/Home/ReadMore")">Cancel</a>*@
                        @*<a href="@Url.Action("Index")" class="btn blue m_btn_bule" id="btnback">Back To List</a>*@
                        <a onclick="ReadMore();" class="btn blue m_btn_bule" id="btnback">Back To List</a>
                    </div>
                </div>
            </div>
            @*</form>*@
        }
    </div>
</div>

@*added div for pop-up*@
<div id="AssignDiv" style="width: 30% !important; height: 20% !important; z-index: 1000000;
        background-color: White; top: 20%; left: 40%" class="modal fade">
    @*REMOVED SHOW CLASS TAKEN MODAL FADE CLASS INSTEAD OF MODAL SHOW FADE CLASS BY SHRADDHA ON 09 FEB 2018 BECAUSE IT WAS CREATING CLICKING ISSUE*@
    <div class="modal-body">
        E-mail sent successfully.
    </div>
    <div class="modal-footer">

        <button type="button" data-dismiss="modal" class="col-md-2  btn btn-primary" id="OkBtn">Ok</button>
    </div>
</div>
<div id="AssignDiv1" style="width: 30% !important; height: 20% !important; z-index: 1000000;
        background-color: White; top: 20%; left: 40%" class="modal fade">
    @*REMOVED SHOW CLASS TAKEN MODAL FADE CLASS INSTEAD OF MODAL SHOW FADE CLASS BY SHRADDHA ON 09 FEB 2018 BECAUSE IT WAS CREATING CLICKING ISSUE*@
    <div class="modal-body">
        E-mail not sent successfully.
    </div>
    <div class="modal-footer">

        <button type="button" data-dismiss="modal" class="col-md-2  btn btn-primary" id="OkBtn">Ok</button>
    </div>
</div>
<div id="AssignDiv3" style="width: 30% !important; height: 20% !important; z-index: 1000000;
        background-color: White; top: 20%; left: 40%" class="modal fade">
    @*REMOVED SHOW CLASS TAKEN MODAL FADE CLASS INSTEAD OF MODAL SHOW FADE CLASS BY SHRADDHA ON 09 FEB 2018 BECAUSE IT WAS CREATING CLICKING ISSUE*@
    <div class="modal-body">
        Message sent successfully.
    </div>
    <div class="modal-footer">

        <button type="button" data-dismiss="modal" class="col-md-2  btn btn-primary" id="OkBtn">Ok</button>
    </div>
</div>
<div id="AssignDiv4" style="width: 30% !important; height: 20% !important; z-index: 1000000;
        background-color: White; top: 20%; left: 40%" class="modal fade">
    @*REMOVED SHOW CLASS TAKEN MODAL FADE CLASS INSTEAD OF MODAL SHOW FADE CLASS BY SHRADDHA ON 09 FEB 2018 BECAUSE IT WAS CREATING CLICKING ISSUE*@
    <div class="modal-body">
        Message not sent successfully.
    </div>
    <div class="modal-footer">

        <button type="button" data-dismiss="modal" class="col-md-2  btn btn-primary" id="OkBtn">Ok</button>
    </div>
</div>

<script type="text/javascript">

    function SendMessage() {
        debugger;
        var ToEmpTypeId = $("#ToEmpTypeId").val();
        alert(ToEmpTypeId);
        var MessageSubject = $("#MessageSubject").val();
        alert(MessageSubject);
        var MessageContent = $("#MessageContent").val();
        alert(MessageContent);
        var FromEmpId = $("#FromEmpId").val();
        alert(FromEmpId);
        var MessageSubjectText = $("#MessageSubjectText").val();
        alert(MessageSubjectText);
        var ToEmpId = $("#ToEmpId").val();
        alert(ToEmpId);
        if (ToEmpTypeId == "") {
            alert("please select dropdown");
        }

        //        $.ajax({
        //            url: '@Url.Content("~/Home/SendMessage")',
        //            type: "POST",
        //            //datatype: "json",
        //            data: { ToEmpTypeId: ToEmpTypeId, MessageSubject: MessageSubject, MessageContent: MessageContent, FromEmpId: FromEmpId, MessageSubjectText: MessageSubjectText, ToEmpId: ToEmpId },
        //            success: function (data) {

        //            },
        //            error: function (data) {

        //            }
        //        });
        $.ajax({
            url: '@Url.Content("~/Home/SendMessage")',
            type: "Get",
            //datatype: "json",
            data: { ToEmpTypeId: ToEmpTypeId, MessageSubject: MessageSubject, MessageContent: MessageContent, FromEmpId: FromEmpId, MessageSubjectText: MessageSubjectText, ToEmpId: ToEmpId },
            success: function (data) {

            },
            error: function (data) {

            }
        });
    }
    $(document).ready(function () {

        $("ToEmpTypeIdmsg").html("");
        $("idMessageSubject").html("");
        $("idMessageContent").html("");

        $("#IndividualEmployees").css("display", "none");
        $("#MessageSubjectText").css("display", "none");
        var ToEmpTypeId = $("#ToEmpTypeId").val();
        if (ToEmpTypeId == 5) {
            $("#IndividualEmployees").css("display", "inline");
        }
        else {
            $("#IndividualEmployees").css("display", "none");
        }
    });

    $("#ToEmpTypeId").change(function () {
        $("#ToEmpTypeIdmsg").html("");

        var ToEmpTypeId = $("#ToEmpTypeId").val();
        if (ToEmpTypeId == 5) {
            $("#IndividualEmployees").css("display", "inline");
            var employeeid = +$("#FromEmpId").val();
            $.ajax({
                url: '@Url.Content("~/Home/EmployeesReportingtoMe")',
                type: "POST",
                dataType: "json",
                data: { EmployeeId: employeeid },
                success: function (data) {

                    $("#ToEmpId").empty();

                    $("#ToEmpId").append("<option value=" + "0" + ">" + "Select" + "</option>");

                    for (var i = 0; i < data.length; i++) {

                        $("#ToEmpId").append("<option value=" + "" + data[i].EmployeeId + "" + ">" + data[i].EmployeeName + "</option>");

                    }
                },
                error: function (data) {
                    //alert("hello");
                }

            });
        }
        else {
            $("#IndividualEmployees").css("display", "none");
        }
    });

    $("#MessageSubject").change(function () {
        $("#idMessageSubject").html("");
        var ToEmpTypeId = $("#MessageSubject").val();
        if (ToEmpTypeId == 2) {
            $("#MessageSubjectText").css("display", "inline");
        }
        else {
            $("#MessageSubjectText").css("display", "none");
        }
    });

    $("#MessageContent").keyup(function () {
        var msg3 = "Please Enter Message";
        if (this.val == "") {
            $("#idMessageContent").html(msg3);

        }
        else {
            $("#idMessageContent").html("");
        }

    });
</script>
<script type="text/javascript">
    $(function () {

        $(".select2").select2();



    });
    //CKEDITOR.replace('MessageContent');  commented for debugging
</script>
@*ADDED SCRIPT BY SHRADDHA ON 23 JAN 2017 FOR SENDING EMAIL START*@
<script type="text/javascript">

    $("#SendEmail").click(function () {
        showloading();
        var msg1 = "Please select Proper value";
        var msg2 = "Please select Subject";
        var msg3 = "Please Enter Message";
        var ToEmpId = $("#ToEmpId").val();
        var message = $("#MessageContent").val();
        var onlySpaceMsg = 0;
        if (!message.replace(/\s/g, '').length) {
            onlySpaceMsg = 1;
        }
        var subject = $("#MessageSubject").val();
        var subjectText = "PreSelect";
        if ($("#MessageSubjectText").val() != null && $("#MessageSubjectText").val() != "") {
            subjectText = $("#MessageSubjectText").val();
        }
        var ToEmpTypeId = $("#ToEmpTypeId").val();
        if (ToEmpTypeId != "" && message != "" && subject != "" && onlySpaceMsg == 0) {
            $.ajax({
                //url: "~/WetosEmail/SendEmail",
                url: '@Url.Action("SendEmail", "WetosEmail" )',
                type: "Get",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                //data: { sel_messageto: ToEmpId, subject: subject, message: message },
                data: { ToEmail: ToEmpTypeId, Subject: subject, Message: message, SubjectText: subjectText },
                success: function (data) {
                    $('#AssignDiv').modal({ backdrop: 'static', keyboard: false })
                .one('click', '#OkBtn', function () {
                    //alert(result);
                    hideloading();
                    window.location.href = '@Url.Action("EmployeeDashboard", "Dashboard" )';
                });
                    //window.location.href = '@Url.Action("EmployeeDashboard", "Dashboard" )';
                },
                error: function (data) {
                    $('#AssignDiv1').modal({ backdrop: 'static', keyboard: false })
                .one('click', '#OkBtn', function () {
                    //alert(result);
                    hideloading();
                    //window.location.href = '@Url.Action("EmployeeDashboard", "Dashboard" )';
                });
                }
            });
        }
        else {
            debugger;
            if (ToEmpTypeId == "") {
                $("#ToEmpTypeIdmsg").html(msg1);
                //$("#ToBlnk").html("*");
            }
            else {
                $("#ToEmpTypeIdmsg").html("");
                //$("#ToBlnk").html("");
            }

            if (subject == "") {
                $("#idMessageSubject").html(msg2);
                //$("#SubjectBlnk").html("*");
            }
            else {
                $("#idMessageSubject").html("");
                //$("#SubjectBlnk").html("");
            }

            if (message == "" || onlySpaceMsg == 1) {
                $("#idMessageContent").html(msg3);
                //$("#MessageBlnk").html("*");
            }
            else {
                $("#idMessageContent").html("");
                //$("#MessageBlnk").html("");
            }
            hideloading();
        }
    });
    $("#BtnSubmit").click(function () {
        showloading();
        var msg1 = "Please select Proper value";
        var msg2 = "Please select Subject";
        var msg3 = "Please Enter Message";
        var ToEmpTypeId = $("#ToEmpTypeId").val();
        var MessageSubject = $("#MessageSubject").val();
        var MessageContent = $("#MessageContent").val();
        var onlySpaceMsg = 0;
        if (!MessageContent.replace(/\s/g, '').length) {
            onlySpaceMsg = 1;
        }
        var FromEmpId = $("#FromEmpId").val();
        var MessageSubjectText = $("#MessageSubjectText").val();
        var ToEmpId = $("#ToEmpId").val();

        if (ToEmpTypeId != "" && MessageSubject != "" && MessageContent != "" && onlySpaceMsg == 0) {
            $.ajax({
                url: '@Url.Content("~/Home/SendMessage")',
                type: "Get",
                //datatype: "json",
                data: { ToEmpTypeId: ToEmpTypeId, MessageSubject: MessageSubject, MessageContent: MessageContent, FromEmpId: FromEmpId, MessageSubjectText: MessageSubjectText, ToEmpId: ToEmpId },
                success: function (data) {
                    $('#AssignDiv3').modal({ backdrop: 'static', keyboard: false })
                    .one('click', '#OkBtn', function () {
                    //alert(result);
                    hideloading();
                    //window.location.href = '@Url.Action("EmployeeDashboard", "Dashboard" )';
                        ReadMore();
                    });
                    //window.location.href = "@Url.Action("Index")";
                },
                error: function (data) {
                    $('#AssignDiv4').modal({ backdrop: 'static', keyboard: false })
                    .one('click', '#OkBtn', function () {
                    hideloading();
                    });
                }
            });
        }
        else {
            debugger;
            if (ToEmpTypeId == "") {
                $("#ToEmpTypeIdmsg").html(msg1);
                //$("#ToBlnk").html("*");
            }
            else {
                $("#ToEmpTypeIdmsg").html("");
                //$("#ToBlnk").html("");
            }

            if (MessageSubject == "") {
                $("#idMessageSubject").html(msg2);
                //$("#SubjectBlnk").html("*");
            }
            else {
                $("#idMessageSubject").html("");
                //$("#SubjectBlnk").html("");
            }

            if (MessageContent == "" || onlySpaceMsg == 1) {
                $("#idMessageContent").html(msg3);
                //$("#MessageBlnk").html("*");
            }
            else {
                $("#idMessageContent").html("");
                //$("#MessageBlnk").html("");
            }
            hideloading();
        }
    });
</script>
@*ADDED SCRIPT BY SHRADDHA ON 23 JAN 2017 FOR SENDING EMAIL END*@ 